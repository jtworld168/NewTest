<view class="container">
  <!-- Store Selector -->
  <view class="store-selector">
    <picker mode="selector" range="{{storeNames}}" bindchange="onStoreChange">
      <view class="store-picker">
        <text class="store-icon">🏪</text>
        <text class="store-name">{{selectedStoreName}}</text>
        <text class="store-arrow">▼</text>
      </view>
    </picker>
  </view>

  <!-- Search Bar with Scan Button -->
  <view class="search-bar">
    <view class="search-input" bindtap="goToCategory">
      <text class="search-icon">🔍</text>
      <text class="search-placeholder">搜索商品</text>
    </view>
    <view class="scan-btn" bindtap="onScan">
      <text class="scan-icon">📷</text>
    </view>
  </view>

  <!-- Swiper Banner -->
  <view class="swiper-section">
    <swiper class="banner-swiper" indicator-dots autoplay interval="{{3000}}" circular>
      <swiper-item>
        <view class="banner-item banner-1">
          <text class="banner-text">智慧零售 · 智能购物</text>
          <text class="banner-sub">随时随地，扫码即购</text>
        </view>
      </swiper-item>
      <swiper-item>
        <view class="banner-item banner-2">
          <text class="banner-text">新品上架</text>
          <text class="banner-sub">更多优质好物等你来发现</text>
        </view>
      </swiper-item>
      <swiper-item>
        <view class="banner-item banner-3">
          <text class="banner-text">员工专享折扣</text>
          <text class="banner-sub">内部员工享受更优价格</text>
        </view>
      </swiper-item>
    </swiper>
  </view>

  <!-- Category Quick Links -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">商品分类</text>
      <text class="section-more" bindtap="goToCategory">查看全部 ></text>
    </view>
    <scroll-view class="category-scroll" scroll-x="true">
      <view class="category-item" wx:for="{{categories}}" wx:key="id" bindtap="goToCategoryDetail" data-id="{{item.id}}">
        <view class="category-icon">📦</view>
        <text class="category-name">{{item.name}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- Product List (Single Column) -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">热门商品</text>
    </view>
    <view class="product-list" wx:if="{{!loading}}">
      <view class="product-row" wx:for="{{products}}" wx:key="id">
        <image class="product-row-image" src="{{item._imageUrl || '/images/product-placeholder.png'}}" mode="aspectFill" bindtap="goToProductDetail" data-id="{{item.id}}"></image>
        <view class="product-row-info">
          <text class="product-name" bindtap="goToProductDetail" data-id="{{item.id}}">{{item.name}}</text>
          <text class="product-desc" wx:if="{{item.description}}">{{item.description}}</text>
          <view class="product-bottom">
            <view class="price-area">
              <text class="price">¥{{item._displayPrice}}</text>
              <text class="original-price" wx:if="{{item._isEmployee}}">¥{{item.price}}</text>
              <text class="employee-tag" wx:if="{{item._isEmployee}}">内购价</text>
            </view>
            <view class="product-qty-control">
              <view class="product-qty-btn" bindtap="decreaseQty" data-id="{{item.id}}">-</view>
              <text class="product-qty-num">{{item._cartQty || 0}}</text>
              <view class="product-qty-btn {{item._bouncing ? 'cart-bounce' : ''}}" bindtap="increaseQty" data-id="{{item.id}}">+</view>
            </view>
          </view>
        </view>
      </view>
    </view>
    <view class="loading" wx:if="{{loading}}">
      <text>加载中...</text>
    </view>
    <view class="empty-state" wx:if="{{!loading && products.length === 0}}">
      <text class="empty-icon">🛒</text>
      <text class="empty-text">暂无商品</text>
    </view>
  </view>

  <!-- Cart drop animation ball -->
  <view class="cart-drop-ball" wx:if="{{showDropBall}}" style="left:{{dropBallX}}px;top:{{dropBallY}}px;" animation="{{dropBallAnimation}}">
    <view class="drop-ball-inner">+1</view>
  </view>
</view>
