<view class="container" wx:if="{{order}}">
  <!-- Status banner -->
  <view class="status-banner status-{{order.status}}">
    <text class="status-icon">{{order.status === 'PENDING' ? 'â³' : order.status === 'PAID' ? 'âœ…' : order.status === 'COMPLETED' ? 'ğŸ‰' : 'âŒ'}}</text>
    <text class="status-text">{{order.status === 'PENDING' ? 'å¾…æ”¯ä»˜' : order.status === 'PAID' ? 'å·²æ”¯ä»˜' : order.status === 'COMPLETED' ? 'å·²å®Œæˆ' : 'å·²å–æ¶ˆ'}}</text>
  </view>

  <!-- Product info - shows ALL items -->
  <view class="detail-card">
    <text class="card-title">å•†å“ä¿¡æ¯ ({{orderItems.length}}ä»¶)</text>
    <view class="store-info" wx:if="{{order._storeName}}">
      <text class="store-label">åº—é“º: </text>
      <text class="store-name">{{order._storeName}}</text>
    </view>
    <view wx:for="{{orderItems}}" wx:key="productId" class="product-row">
      <image class="product-image" src="{{item._imageUrl || '/images/product-placeholder.png'}}" mode="aspectFill"></image>
      <view class="product-info">
        <text class="product-name">{{item._productName || 'å•†å“'}}</text>
        <view class="product-price-row">
          <text class="product-price">å•ä»·: Â¥{{item._priceDisplay}}</text>
          <text class="original-price" wx:if="{{item._hasEmployeeDiscount}}">Â¥{{item._originalPrice}}</text>
          <text class="employee-tag" wx:if="{{item._hasEmployeeDiscount}}">å‘˜å·¥æŠ˜æ‰£</text>
        </view>
        <text class="product-qty">æ•°é‡: x{{item.quantity}}</text>
        <text class="product-subtotal">å°è®¡: Â¥{{item._subtotalDisplay}}</text>
        <text class="product-barcode" wx:if="{{item._barcode}}">æ¡å½¢ç : {{item._barcode}}</text>
      </view>
    </view>
  </view>

  <!-- Price breakdown -->
  <view class="detail-card">
    <text class="card-title">ä»·æ ¼æ˜ç»†</text>
    <view class="price-row" wx:if="{{isEmployeeOrder}}">
      <text class="price-label">å•†å“åŸä»·</text>
      <text class="price-value">Â¥{{originalTotal}}</text>
    </view>
    <view class="price-row discount-row" wx:if="{{isEmployeeOrder}}">
      <text class="price-label">ğŸ·ï¸ å‘˜å·¥æŠ˜æ‰£</text>
      <text class="price-value discount">-Â¥{{discountAmount}}</text>
    </view>
    <view class="price-row" wx:if="{{order.userCouponId}}">
      <text class="price-label">ğŸ« ä¼˜æƒ åˆ¸</text>
      <text class="price-value discount">å·²ä½¿ç”¨</text>
    </view>
    <view class="price-row total-row">
      <text class="price-label">å®ä»˜é‡‘é¢</text>
      <text class="price-value total">Â¥{{order._totalDisplay}}</text>
    </view>
    <view class="employee-notice" wx:if="{{isEmployeeOrder}}">
      <text>ğŸ’¡ å‘˜å·¥æŠ˜æ‰£ä¸ä¼˜æƒ åˆ¸ä¸å¯å åŠ ä½¿ç”¨</text>
    </view>
  </view>

  <!-- Order info -->
  <view class="detail-card">
    <text class="card-title">è®¢å•ä¿¡æ¯</text>
    <view class="info-row">
      <text class="info-label">è®¢å•ç¼–å·</text>
      <text class="info-value">{{order.id}}</text>
    </view>
    <view class="info-row">
      <text class="info-label">åˆ›å»ºæ—¶é—´</text>
      <text class="info-value">{{order.createTime || '-'}}</text>
    </view>
    <view class="info-row" wx:if="{{payment}}">
      <text class="info-label">æ”¯ä»˜æ–¹å¼</text>
      <text class="info-value">{{payment.paymentMethod === 'WECHAT' ? 'å¾®ä¿¡æ”¯ä»˜' : payment.paymentMethod === 'ALIPAY' ? 'æ”¯ä»˜å®' : payment.paymentMethod === 'CARD' ? 'é“¶è¡Œå¡' : 'ç°é‡‘'}}</text>
    </view>
    <view class="info-row" wx:if="{{payment}}">
      <text class="info-label">æ”¯ä»˜æ—¶é—´</text>
      <text class="info-value">{{payment.paymentTime || '-'}}</text>
    </view>
    <view class="info-row" wx:if="{{payment}}">
      <text class="info-label">äº¤æ˜“å·</text>
      <text class="info-value">{{payment.transactionNo || '-'}}</text>
    </view>
  </view>

  <!-- Action buttons -->
  <view class="actions" wx:if="{{order.status === 'PENDING'}}">
    <button class="btn-cancel" bindtap="cancelOrder">å–æ¶ˆè®¢å•</button>
    <button class="btn-pay" bindtap="goToPay">å»æ”¯ä»˜</button>
  </view>
  <view class="actions" wx:if="{{order.status === 'PAID'}}">
    <button class="btn-confirm" bindtap="confirmReceive">ç¡®è®¤æ”¶è´§</button>
  </view>
</view>

<view class="loading" wx:if="{{loading}}">
  <text>åŠ è½½ä¸­...</text>
</view>
