<view class="container">
  <!-- Not logged in -->
  <view class="empty-state" wx:if="{{!loading && !cartItems.length}}">
    <text class="empty-icon">ğŸ›’</text>
    <text class="empty-text">è´­ç‰©è½¦ç©ºç©ºå¦‚ä¹Ÿ</text>
    <button class="btn-primary go-shop-btn" bindtap="goLogin" wx:if="{{!cartItems.length}}">å»é€›é€›</button>
  </view>

  <!-- Cart Items -->
  <view wx:if="{{cartItems.length > 0}}">
    <!-- Clear button -->
    <view class="cart-header">
      <text class="cart-title">è´­ç‰©è½¦ ({{cartItems.length}})</text>
      <text class="clear-btn" bindtap="clearCart">æ¸…ç©º</text>
    </view>

    <view class="cart-item" wx:for="{{cartItems}}" wx:key="id">
      <!-- Checkbox -->
      <view class="checkbox {{selectedIds.indexOf(item.id) > -1 ? 'checked' : ''}}" bindtap="toggleSelect" data-id="{{item.id}}">
        <text wx:if="{{selectedIds.indexOf(item.id) > -1}}">âœ“</text>
      </view>

      <!-- Product image -->
      <image class="item-image" src="{{productMap[item.productId].image ? getFileUrl(productMap[item.productId].image) : '/images/product-placeholder.png'}}" mode="aspectFill"></image>

      <!-- Info -->
      <view class="item-info">
        <text class="item-name">{{productMap[item.productId].name || 'å•†å“'}}</text>
        <text class="price">Â¥{{productMap[item.productId].price || '0'}}</text>
        <view class="quantity-control">
          <view class="qty-btn" bindtap="changeQuantity" data-id="{{item.id}}" data-action="minus">-</view>
          <text class="qty-num">{{item.quantity}}</text>
          <view class="qty-btn" bindtap="changeQuantity" data-id="{{item.id}}" data-action="add">+</view>
          <view class="delete-btn" bindtap="deleteItem" data-id="{{item.id}}">åˆ é™¤</view>
        </view>
      </view>
    </view>

    <!-- Bottom Bar -->
    <view class="bottom-bar">
      <view class="select-all" bindtap="toggleSelectAll">
        <view class="checkbox {{selectedIds.length === cartItems.length ? 'checked' : ''}}">
          <text wx:if="{{selectedIds.length === cartItems.length}}">âœ“</text>
        </view>
        <text>å…¨é€‰</text>
      </view>
      <view class="total">
        <text>åˆè®¡: </text>
        <text class="price">Â¥{{totalPrice}}</text>
      </view>
      <button class="checkout-btn" bindtap="checkout">ç»“ç®— ({{selectedIds.length}})</button>
    </view>
  </view>

  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>
